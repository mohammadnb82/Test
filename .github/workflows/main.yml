name: Test Site Python Controller

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

permissions:
  contents: write      # Ø§Ø¬Ø§Ø²Ù‡ Ù†ÙˆØ´ØªÙ† Ùˆ Ø­Ø°Ù ÙØ§ÛŒÙ„â€ŒÙ‡Ø§
  pages: write         # Ø§Ø¬Ø§Ø²Ù‡ Ø§Ù†ØªØ´Ø§Ø± Ø³Ø§ÛŒØª
  id-token: write      # Ø§Ø¬Ø§Ø²Ù‡ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ø§Ù…Ù†

jobs:
  ultimate-execution:
    runs-on: ubuntu-latest
    
    steps:
      # Û±. Ø¯Ø§Ù†Ù„ÙˆØ¯ Ú©Ù„ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡
      - name: Checkout Repository
        uses: actions/checkout@v4

      # Û². Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù…Ø­ÛŒØ· Ù¾Ø§ÛŒØªÙˆÙ†
      - name: Setup Python Environment
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      # Û³. Ù†ØµØ¨ Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø² (Selenium, Chrome, Requests)
      - name: Install System & Python Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y google-chrome-stable unzip
          pip install --upgrade pip
          pip install selenium webdriver-manager requests beautifulsoup4 lxml

      # Û´. Ø§Ø¬Ø±Ø§ÛŒ Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø§ØµÙ„ÛŒ (Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡ Ø¨Ø± Ø§Ø³Ø§Ø³ ÙØ§ÛŒÙ„ setup.py Ø´Ù…Ø§)
      - name: Run Python Script (setup.py)
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          PERSONAL_TOKEN: ${{ secrets.PERSONAL_TOKEN }}
          TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
          WHATSAPP_TOKEN: ${{ secrets.WHATSAPP_TOKEN }}
          INSTAGRAM_TOKEN: ${{ secrets.INSTAGRAM_TOKEN }}
          EMAIL_PASSWORD: ${{ secrets.EMAIL_PASSWORD }}
        run: python setup.py

      # Ûµ. Ø°Ø®ÛŒØ±Ù‡ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªÙˆÙ„ÛŒØ¯ Ø´Ø¯Ù‡ Ø¯Ø± Ù¾ÙˆØ´Ù‡ tools Ø¨Ù‡ Ø´Ø§Ø®Ù‡ Ø§ØµÙ„ÛŒ
      # Ù†Ú©ØªÙ‡: ÙØ±Ø¶ Ø¨Ø± Ø§ÛŒÙ† Ø§Ø³Øª Ú©Ù‡ ÙØ§ÛŒÙ„ setup.py Ø´Ù…Ø§ Ø®Ø±ÙˆØ¬ÛŒ Ø±Ø§ Ø¯Ø± Ù¾ÙˆØ´Ù‡ tools Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
      - name: Save Generated Tools to Main Branch
        run: |
          git config --global user.name "Test Site Bot"
          git config --global user.email "bot@test-site.com"
          git add tools/ || echo "No tools directory found to add"
          git commit -m "ğŸ—ï¸ Auto-generated content added to repo" || echo "No changes to commit"
          git push origin HEAD:main

      # Û¶. Ø§Ù†ØªØ´Ø§Ø± Ù†Ù‡Ø§ÛŒÛŒ Ø¯Ø± Ú¯ÛŒØªâ€ŒÙ‡Ø§Ø¨ Ù¾ÛŒØ¬
      - name: Deploy Result to GitHub Pages
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: .
          clean: true
          branch: gh-pages
