<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูพุฑุฏุงุฒุด ุตุฏุง</title>
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-link">ุจุงุฒฺฏุดุช ุจู ุฎุงูู</a>
        <div class="card">
            <h2>๐ต ุงุณุชูุฏู ุตุฏุง (Web Audio API)</h2>
            <p>ูุงู ุตูุช ุงูุชุฎุงุจ ฺฉูุฏ ู ุงูฺฉุชโูุง ุฒูุฏู ุงุนูุงู ฺฉูุฏ.</p>
            
            <div class="upload-box" onclick="document.getElementById('audioInput').click()">
                ๐ ุงูุชุฎุงุจ ูุงู ุตูุช
            </div>
            <input type="file" id="audioInput" accept="audio/*" style="display:none">
            
            <audio id="audioPlayer" controls style="width:100%; margin: 20px 0; display:none"></audio>
            
            <div class="controls" id="eqControls" style="display:none;">
                <label>ุจุงุณ (Bass): <span id="bassVal">0</span></label>
                <input type="range" id="bassRange" min="-10" max="10" value="0">
                
                <label>ุชุฑุจู (Treble): <span id="trebleVal">0</span></label>
                <input type="range" id="trebleRange" min="-10" max="10" value="0">
                
                <label>ุญุฌู ุตุฏุง (Volume)</label>
                <input type="range" id="volRange" min="0" max="2" step="0.1" value="1">
            </div>
        </div>
    </div>

    <script>
        const audioInput = document.getElementById('audioInput');
        const audioPlayer = document.getElementById('audioPlayer');
        const eqControls = document.getElementById('eqControls');
        
        let audioContext;
        let source;
        let bassFilter, trebleFilter, gainNode;

        audioInput.addEventListener('change', function() {
            const file = this.files[0];
            const url = URL.createObjectURL(file);
            audioPlayer.src = url;
            audioPlayer.style.display = 'block';
            eqControls.style.display = 'block';
            
            initAudioContext();
        });

        function initAudioContext() {
            if(!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                // ุงุฌุงุฏ ุณูุฑุณ ูุฏุง
                source = audioContext.createMediaElementSource(audioPlayer);
                
                // ููุชุฑ ุจุงุณ (Low Shelf)
                bassFilter = audioContext.createBiquadFilter();
                bassFilter.type = "lowshelf";
                bassFilter.frequency.value = 200; // ูุฑฺฉุงูุณโูุง ุฒุฑ 200 ูุฑุชุฒ
                
                // ููุชุฑ ุชุฑุจู (High Shelf)
                trebleFilter = audioContext.createBiquadFilter();
                trebleFilter.type = "highshelf";
                trebleFilter.frequency.value = 2000; // ูุฑฺฉุงูุณโูุง ุจุงูุง 2000 ูุฑุชุฒ
                
                // ูููู
                gainNode = audioContext.createGain();
                
                // ุงุชุตุงู ฺฏุฑูโูุง: Source -> Bass -> Treble -> Volume -> Output
                source.connect(bassFilter);
                bassFilter.connect(trebleFilter);
                trebleFilter.connect(gainNode);
                gainNode.connect(audioContext.destination);
            }
        }

        // ฺฉูุชุฑูุฑ ุจุงุณ
        document.getElementById('bassRange').addEventListener('input', function() {
            if(bassFilter) bassFilter.gain.value = this.value;
            document.getElementById('bassVal').innerText = this.value;
        });

        // ฺฉูุชุฑูุฑ ุชุฑุจู
        document.getElementById('trebleRange').addEventListener('input', function() {
            if(trebleFilter) trebleFilter.gain.value = this.value;
            document.getElementById('trebleVal').innerText = this.value;
        });
        
        // ฺฉูุชุฑูุฑ ูููู
        document.getElementById('volRange').addEventListener('input', function() {
            if(gainNode) gainNode.gain.value = this.value;
        });
        
        // ุญู ูุดฺฉู AutoPlay Policy ุฏุฑ ูุฑูุฑฺฏุฑูุง
        audioPlayer.addEventListener('play', () => {
            if(audioContext && audioContext.state === 'suspended') {
                audioContext.resume();
            }
        });
    </script>
</body>
</html>